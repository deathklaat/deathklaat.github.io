(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["stories"],{"199a":function(t,e,r){},2909:function(t,e,r){"use strict";r.d(e,"a",(function(){return c}));var s=r("6b75");function i(t){if(Array.isArray(t))return Object(s["a"])(t)}r("a4d3"),r("e01a"),r("d3b7"),r("d28b"),r("3ca3"),r("ddb0"),r("a630");function o(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}var a=r("06c5");function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t){return i(t)||o(t)||Object(a["a"])(t)||n()}},"4f67":function(t,e,r){t.exports=r.p+"img/ic_filter.1e3f3870.svg"},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,r){var s=r("1d80"),i=r("5899"),o="["+i+"]",a=RegExp("^"+o+o+"*"),n=RegExp(o+o+"*$"),c=function(t){return function(e){var r=String(s(e));return 1&t&&(r=r.replace(a,"")),2&t&&(r=r.replace(n,"")),r}};t.exports={start:c(1),end:c(2),trim:c(3)}},a9e3:function(t,e,r){"use strict";var s=r("83ab"),i=r("da84"),o=r("94ca"),a=r("6eeb"),n=r("5135"),c=r("c6b6"),l=r("7156"),u=r("c04e"),d=r("d039"),f=r("7c73"),g=r("241c").f,h=r("06cf").f,p=r("9bf2").f,y=r("58a8").trim,v="Number",_=i[v],m=_.prototype,b=c(f(m))==v,C=function(t){var e,r,s,i,o,a,n,c,l=u(t,!1);if("string"==typeof l&&l.length>2)if(l=y(l),e=l.charCodeAt(0),43===e||45===e){if(r=l.charCodeAt(2),88===r||120===r)return NaN}else if(48===e){switch(l.charCodeAt(1)){case 66:case 98:s=2,i=49;break;case 79:case 111:s=8,i=55;break;default:return+l}for(o=l.slice(2),a=o.length,n=0;n<a;n++)if(c=o.charCodeAt(n),c<48||c>i)return NaN;return parseInt(o,s)}return+l};if(o(v,!_(" 0o1")||!_("0b1")||_("+0x1"))){for(var k,S=function(t){var e=arguments.length<1?0:t,r=this;return r instanceof S&&(b?d((function(){m.valueOf.call(r)})):c(r)!=v)?l(new _(C(e)),r,S):C(e)},w=s?g(_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),I=0;w.length>I;I++)n(_,k=w[I])&&!n(S,k)&&p(S,k,h(_,k));S.prototype=m,m.constructor=S,a(i,v,S)}},bc87:function(t,e,r){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function o(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}r.d(e,"a",(function(){return c}));r("b0c0");var a=r("1881"),n=r.n(a),c=function(){function t(e){var r=e.component,i=e.props,o=void 0===i?{}:i,a=e.params,n=void 0===a?{}:a,c=e.events,l=void 0===c?{}:c;s(this,t),this.component=r,this.props=o,this.params=n,this.events={opened:function(){Object.assign(r,{modalName:n.name})},closed:function(){}},Object.assign(this.events,l)}return o(t,[{key:"show",value:function(){n.a.rootInstance.$modal.show(this.component,this.props,this.params,this.events)}},{key:"hide",value:function(){n.a.rootInstance.$emit("close")}}]),t}()},d3fe:function(t,e,r){"use strict";r.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.pageIsReady?s("div",{staticClass:"stories-page page"},[s("div",{staticClass:"stories-page__header"},[s("div",{staticClass:"page__title mb-0"},[s("nav-back"),t._v(" Истории "),s("span",{staticClass:"stories-page__counter"},[t._v(t._s(Object.keys(t.stories).length))])],1),s("div",{staticClass:"stories-page__right-block d-flex"},[s("div",{staticClass:"stories-page__all-stories-checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showAllStories,expression:"showAllStories"}],staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.showAllStories)?t._i(t.showAllStories,null)>-1:t.showAllStories},on:{change:function(e){var r=t.showAllStories,s=e.target,i=!!s.checked;if(Array.isArray(r)){var o=null,a=t._i(r,o);s.checked?a<0&&(t.showAllStories=r.concat([o])):a>-1&&(t.showAllStories=r.slice(0,a).concat(r.slice(a+1)))}else t.showAllStories=i}}}),s("label",[t._v("Показать все истории")])]),s("ui-button",{staticClass:"stories-page__filter-button d-flex",attrs:{color:"transparent"},on:{clicked:t.onCategoryFilterClick}},[t._v(" Фильтр "),s("img",{staticClass:"stories-page__filter-icon",attrs:{src:r("4f67"),width:"22",height:"20"}})]),s("ui-button",{on:{clicked:t.resetSearchFields}},[t._v("Поиск")]),s("ui-button",{staticClass:"stories-page__add-story-button d-flex",attrs:{color:"blue"},on:{clicked:t.onAddStoryClick}},[t._v(" Добавить историю ")])],1)]),t.showSearchPanel?s("div",{staticClass:"stories-page__search-panel form-group"},[s("div",{staticClass:"form-group"},[s("label",[t._v("ID истории")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchStoryId,expression:"searchStoryId"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.searchStoryId},on:{input:function(e){e.target.composing||(t.searchStoryId=e.target.value)}}})]),s("div",{staticClass:"form-group"},[s("label",[t._v("Название истории")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchStoryName,expression:"searchStoryName"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.searchStoryName},on:{input:function(e){e.target.composing||(t.searchStoryName=e.target.value)}}})]),s("ui-button",{on:{clicked:t.onSearchButtonClick}},[t._v("Найти")])],1):t._e(),t.showAllStories?s("div",{staticClass:"stories-page__list"},[s("div",{staticClass:"stories-page__category-title"},[t._v(" Все истории ")]),t.stories.length?s("div",{staticClass:"stories-page__category-stories"},[s("div",{staticClass:"d-flex flex-wrap"},t._l(t.stories,(function(e){return s("div",{key:e.id,staticClass:"list-group-item stories-page__story-item"},[s("story-card",{attrs:{story:e},on:{clicked:t.onStoryClick}})],1)})),0)]):t._e()]):s("div",{staticClass:"stories-page__list"},[t.searchResultList.length?s("div",{staticClass:"stories-page__category-stories"},[s("div",{staticClass:"stories-page__category-title"},[t._v(" Результаты поиска ")]),s("div",{staticClass:"d-flex flex-wrap"},t._l(t.searchResultList,(function(e){return s("div",{key:e.id,staticClass:"list-group-item stories-page__story-item"},[s("story-card",{attrs:{story:e},on:{clicked:t.onStoryClick}})],1)})),0)]):t._e(),t.nonCategoriesStories.length?s("div",{staticClass:"stories-page__category-stories"},[s("div",{staticClass:"stories-page__category-title"},[t._v(" Без категории ")]),s("div",{staticClass:"d-flex flex-wrap"},t._l(t.nonCategoriesStories,(function(e){return s("div",{key:e.id,staticClass:"list-group-item stories-page__story-item"},[s("story-card",{attrs:{story:e},on:{clicked:t.onStoryClick}})],1)})),0)]):t._e(),t._l(t.categoriesList,(function(e,r){return t.availableCategoriesIds.includes(e.id)?s("div",{key:r,staticClass:"stories-page__category-stories"},[s("div",{staticClass:"stories-page__category-title"},[t._v(" "+t._s(e.name)+" ")]),s("div",{staticClass:"stories-page__category-stories-list"},[s("draggable",t._b({staticClass:"list-group",attrs:{tag:"ul",move:t.onCategoryStoryMoved},on:{start:function(e){t.storyDragging=!0},end:function(e){t.storyDragging=!1},change:function(r){return t.onCategoryStoryOrderChange(e.id)}},model:{value:e.stories,callback:function(r){t.$set(e,"stories",r)},expression:"category.stories"}},"draggable",t.storyDragOptions,!1),[s("transition-group",{staticClass:"d-flex flex-wrap",attrs:{type:"transition",name:"flip-list"}},t._l(e.stories,(function(e){return s("li",{key:e.id,staticClass:"list-group-item stories-page__story-item"},[s("story-card",{attrs:{story:e},on:{clicked:t.onStoryClick}})],1)})),0)],1)],1)]):t._e()}))],2),t.showCategoryPicker?s("div",{staticClass:"category-picker"},[s("div",{staticClass:"category-picker__content"},[s("div",{staticClass:"category-picker__close-button",on:{click:t.onCategoryFilterCloseClick}},[s("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])]),s("div",{ref:"categoryPicker",staticClass:"category-picker__list"},t._l(t.categoriesOptions,(function(e,r){return s("div",{key:r,staticClass:"category-picker__category"},[s("input",{staticClass:"category-picker__checkbox",attrs:{type:"checkbox",id:"category-option-"+r},domProps:{checked:e.checked,value:e.id}}),s("label",{staticClass:"page__input-title",attrs:{for:"category-option-"+r}},[t._v(t._s(e.name))])])})),0),s("ui-button",{staticClass:"category-picker__apply-button",on:{clicked:t.sortCategories}},[t._v("ПРИМЕНИТЬ")])],1)]):t._e()]):t._e()},i=[],o=r("2909"),a=r("1da1"),n=r("5530"),c=(r("96cf"),r("d3b7"),r("3ca3"),r("ddb0"),r("d81d"),r("4de4"),r("159b"),r("7db0"),r("b0c0"),r("caad"),r("2532"),r("2f62")),l=r("b76a"),u=r.n(l),d=(r("bc87"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal-popup"},[r("div",{staticClass:"mb-3 modal-popup__title"},[t._v(" Выберите историю "),r("svg",{staticClass:"bi bi-x-lg modal-popup__close",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2D4C70",viewBox:"0 0 16 16"},on:{click:t.close}},[r("path",{attrs:{d:"M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z"}})])]),r("div",{staticClass:"form-group"},[r("b-form-select",{attrs:{options:t.options,disabled:-1===t.selectedStoryId},model:{value:t.selectedStoryId,callback:function(e){t.selectedStoryId=e},expression:"selectedStoryId"}})],1),r("ui-button",{on:{clicked:t.onAddClick}},[t._v("Добавить")])],1)}),f=[],g=(r("a9e3"),r("a70a")),h={props:{categoryId:Number},data:function(){return{selectedStoryId:null,options:[]}},components:{UiButton:function(){return r.e("chunk-7a628425").then(r.bind(null,"832a"))}},computed:{stories:function(){var t=this;return this.$store.state.stories.list.filter((function(e){return!e.categories.find((function(e){return e.id===t.categoryId}))}))}},created:function(){var t=this;this.options=this.stories.filter((function(e){return!e.categories||-1===e.categories.indexOf(t.categoryId)})).map((function(t){return{value:t.id,text:t.title}})),this.options.length?this.selectedStoryId=this.options[0].value:(this.selectedStoryId=-1,this.options=[{value:-1,text:"Нет подходящих историй"}])},methods:Object(n["a"])(Object(n["a"])({},Object(c["d"])("firebase",["ADD_STORY_TO_CATEGORY"])),{},{close:function(){this.$modal.hide("pick-story-modal")},onAddClick:function(){alert("todo допилить, сейчас не сохраняет в фаербазу"),this.ADD_STORY_TO_CATEGORY({categoryId:this.categoryId,storyId:parseInt(this.selectedStoryId,10)}),g["a"].$emit("stories-updated"),this.close()}})},p=h,y=r("2877"),v=Object(y["a"])(p,d,f,!1,null,null,null),_=(v.exports,{data:function(){return{pageIsReady:!1,selectedFilterOption:0,categoriesOptions:[],showCategoryPicker:!1,storyDragging:!1,categoriesList:[],categoryDragLocked:!1,showSearchPanel:!1,searchStoryId:"",searchStoryName:"",searchResultList:[],showAllStories:!1}},components:{draggable:u.a,UiButton:function(){return r.e("chunk-7a628425").then(r.bind(null,"832a"))},StoryCard:function(){return r.e("chunk-5375c262").then(r.bind(null,"de2b"))},NavBack:function(){return r.e("chunk-49c533a1").then(r.bind(null,"e019"))}},computed:{stories:function(){return this.$store.state.firebase.config.Stories.stories},categories:function(){return this.$store.state.firebase.config.Stories.categories},storyDragOptions:function(){return{animation:0,group:"description",disabled:!1,ghostClass:"ghost"}},availableCategoriesIds:function(){return this.categoriesOptions.filter((function(t){return t.checked})).map((function(t){return t.id}))},categoriesListArray:function(){var t=this,e=[];return this.availableCategoriesIds.forEach((function(r){var s=t.categories.find((function(t){return t.id===r})),i=[];t.stories.forEach((function(t){t.categories.find((function(t){return t.id===r}))&&i.push(t)})),e.push({id:s.id,name:s.name,stories:i})})),e},nonCategoriesStories:function(){return this.stories.filter((function(t){return!t.categories||!t.categories.length}))}},created:function(){g["a"].$off("stories-updated").$on("stories-updated",this.fetchData)},beforeDestroy:function(){g["a"].$off("stories-updated",this.fetchData)},mounted:function(){this.fetchData(),this.selectedFilterOption=0},methods:Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(c["b"])("firebase",["getConfig"])),Object(c["b"])("stories",["updateCategoryOrder"])),{},{fetchData:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getConfig();case 2:t.pageIsReady=!0,t.categoriesOptions=t.categories.map((function(t){return{id:t.id,name:t.name,checked:!0}})),t.categoriesList=Object(o["a"])(t.categoriesListArray);case 5:case"end":return e.stop()}}),e)})))()},onStoryClick:function(t){this.$router.push("/story/".concat(t))},onAddStoryClick:function(){this.$router.push("/story")},onCategoryFilterClick:function(){this.showCategoryPicker=!0},onCategoryFilterCloseClick:function(){this.showCategoryPicker=!1},sortCategories:function(){var t=this;if(this.$refs.categoryPicker){var e=this.$refs.categoryPicker.querySelectorAll(".category-picker__checkbox");e.forEach((function(e){var r=parseInt(e.value,10),s=t.categoriesOptions.find((function(t){return t.id===r}));s.checked=e.checked})),this.onCategoryFilterCloseClick()}},onCategoryStoryOrderChange:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){var s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(s=e.categoriesList.find((function(e){return e.id===t})),!s){r.next=7;break}return e.categoryDragLocked=!0,r.next=5,e.updateCategoryOrder({categoryId:t,stories:s.stories.map((function(t){return t.id}))});case 5:e.categoryDragLocked=!1,g["a"].$emit("show-notification-message","Сортировка историй обновлена");case 7:case"end":return r.stop()}}),r)})))()},onCategoryStoryMoved:function(){return!this.categoryDragLocked},resetSearchFields:function(){this.showSearchPanel=!this.showSearchPanel,this.searchStoryId=this.searchStoryName="",this.searchResultList=[]},onSearchButtonClick:function(){var t=this;if(this.searchStoryId.length){var e=this.stories.find((function(e){return e.id===parseInt(t.searchStoryId)}));e&&this.searchResultList.push(e)}else if(this.searchStoryName.length){var r=this.stories.filter((function(e){return e.title.toLowerCase().includes(t.searchStoryName.toLowerCase())}));r.length&&(this.searchResultList=r)}}})}),m=_,b=(r("efb3"),Object(y["a"])(m,s,i,!1,null,null,null));e["default"]=b.exports},efb3:function(t,e,r){"use strict";r("199a")}}]);
//# sourceMappingURL=stories.76d1c714.js.map