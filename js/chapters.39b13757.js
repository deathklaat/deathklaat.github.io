(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chapters"],{5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,r){var a=r("1d80"),n=r("5899"),i="["+n+"]",c=RegExp("^"+i+i+"*"),s=RegExp(i+i+"*$"),o=function(e){return function(t){var r=String(a(t));return 1&e&&(r=r.replace(c,"")),2&e&&(r=r.replace(s,"")),r}};e.exports={start:o(1),end:o(2),trim:o(3)}},"6cae":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chapter-page page"},[r("div",{staticClass:"chapter-page__header"},[r("div",{staticClass:"chapter-page__header-left"},[r("nav-back"),r("div",{staticClass:"chapter-page__number"},[e._v(e._s(e.name))]),r("div",{staticClass:"chapter-page__title"},[e._v(e._s(e.title))])],1),r("div",{staticClass:"chapter-page__header-right"},[r("ui-button",{staticClass:"chapter-page__save-button",class:{"chapter-page__save-button--disabled":!e.anyChanges},attrs:{color:e.saveButtonColor},on:{clicked:e.onSaveClick}},[e._v(" "+e._s(e.saveButtonText)+" ")])],1)]),e.id?r("div",{staticClass:"row mt-3 ml-1",staticStyle:{position:"relative","margin-bottom":"-20px"}},[r("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"chapter-page__story-id mr-2",attrs:{title:"Скопировать ID истории"},on:{click:function(t){return e.clip(e.storyId)}}},[e._v(" ID истории: "+e._s(e.storyId)+" ")]),r("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"chapter-page__story-id",attrs:{title:"Скопировать ID главы"},on:{click:function(t){return e.clip(e.id)}}},[e._v(" ID главы: "+e._s(e.id)+" ")])]):e._e(),r("div",{staticClass:"chapter-page__content d-flex mb-3"},[r("div",{staticClass:"page__title row"},[e._v("Описание главы")]),r("div",{staticClass:"row page__input"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title",attrs:{for:"chapterTitleInput"}},[e._v("Название")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.title,expression:"title"}],staticClass:"form-control",class:{"data-changed":e.titleChanged},attrs:{type:"text",id:"chapterTitleInput",placeholder:"Название"},domProps:{value:e.title},on:{input:function(t){t.target.composing||(e.title=t.target.value)}}})])]),r("div",{staticClass:"row page__input"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title"},[e._v("Краткое описание")]),r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.description,expression:"description"}],staticClass:"form-control",class:{"data-changed":e.descriptionChanged},attrs:{id:"chapterDescriptionInput",rows:"3",placeholder:"Описание"},domProps:{value:e.description},on:{input:function(t){t.target.composing||(e.description=t.target.value)}}})])]),r("div",{staticClass:"row page__input"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title",attrs:{for:"googleSheetId"}},[e._v("ID Google таблицы")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.googleSheetId,expression:"googleSheetId"}],staticClass:"form-control",class:{"data-changed":e.googleSheetChanged},attrs:{type:"text",id:"googleSheetId",placeholder:"ID таблицы"},domProps:{value:e.googleSheetId},on:{input:function(t){t.target.composing||(e.googleSheetId=t.target.value)}}})])]),r("div",{staticClass:"row page__sub-row"},[r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title"},[e._v("Время чтения")]),r("br"),r("b-dropdown",{staticClass:"m-md-2 chapter-page__filter-dropdown page__input-small ml-4",class:{"data-changed":e.readingTimeChanged},attrs:{text:e.readingTimeText}},e._l(e.readingTime,(function(t,a){return r("b-dropdown-item",{key:a,attrs:{"data-value":t.time},on:{click:e.onReadingTimeSelect}},[e._v(" "+e._s(t.text)+" ")])})),1)],1)])]),r("div",{staticClass:"row page__sub-row"},[r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title"},[e._v("Стоимость чтения")]),r("br"),r("b-dropdown",{staticClass:"m-md-2",class:{"data-changed":e.readingRuleChanged},attrs:{text:e.readingCurrencyText,id:"storyCharacterRestriction"}},e._l(e.currenciesOptions,(function(t){return r("b-dropdown-item",{key:t.value,attrs:{"data-value":t.value},on:{click:e.onReadingCurrencyChanged}},[e._v(" "+e._s(t.text)+" ")])})),1),r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.readingCost,expression:"readingCost",modifiers:{number:!0}}],staticClass:"form-control mt-2",class:{"data-changed":e.readingRuleChanged},attrs:{type:"number",placeholder:"0",min:"0",oninput:"validity.valid||(value=0)"},domProps:{value:e.readingCost},on:{input:function(t){t.target.composing||(e.readingCost=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})],1)])]),r("label",{staticClass:"chapter-page__label",class:{"data-changed":e.rewardsChanged}},[e._v(" Награды за прохождение главы ")]),e._l(e.rewards,(function(t){return void 0!==typeof e.selectedRewardOptions["currency-"+t.currency_id]?r("div",{key:t.currency_id,staticClass:"mb-4",on:{click:e.onRewardsClick}},[r("div",{staticClass:"d-flex flex-row align-items-center"},[r("div",{staticClass:"d-flex flex-column"},[r("b-form-select",{staticClass:"form-control chapter-page__reward-input",attrs:{options:e.currenciesOptions},model:{value:e.selectedRewardOptions["currency-"+t.currency_id],callback:function(r){e.$set(e.selectedRewardOptions,"currency-"+t.currency_id,r)},expression:"selectedRewardOptions[`currency-${reward.currency_id}`]"}}),r("input",{directives:[{name:"model",rawName:"v-model.number",value:e.rewardValues["currency-"+t.currency_id],expression:"rewardValues[`currency-${reward.currency_id}`]",modifiers:{number:!0}}],staticClass:"form-control mt-2 chapter-page__reward-input",attrs:{type:"number",placeholder:"Количество",min:"0",oninput:"validity.valid||(value=0)"},domProps:{value:e.rewardValues["currency-"+t.currency_id]},on:{input:function(r){r.target.composing||e.$set(e.rewardValues,"currency-"+t.currency_id,e._n(r.target.value))},blur:function(t){return e.$forceUpdate()}}})],1),r("div",{staticClass:"d-flex flex-column"},[e.isDefaultReward?e._e():r("svg",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"bi bi-x-circle ml-4 story-page__reset-reward",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",title:"Удалить награду",viewBox:"0 0 16 16"},on:{click:function(r){return e.deleteReward(t.currency_id)}}},[r("path",{attrs:{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}}),r("path",{attrs:{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"}})])])])]):e._e()})),e.rewards.length?e._e():r("span",{staticClass:"mb-3 mt-1",staticStyle:{"font-size":"16px"}},[e._v("Отсутствуют")]),e.getAvailableCurrencies().length?r("ui-button",{staticClass:"mb-2",staticStyle:{"max-width":"290px"},attrs:{color:"transparent"},on:{clicked:e.addReward}},[e._v(" Добавить награду ")]):e._e(),r("ui-button",{staticStyle:{"max-width":"290px"},attrs:{color:"transparent"},on:{clicked:e.resetRewardToDefault}},[e._v(" Сбросить награды на дефолт ")])],2)])},n=[],i=r("3835"),c=r("ade3"),s=r("1da1"),o=r("5530"),d=(r("96cf"),r("a9e3"),r("d3b7"),r("3ca3"),r("ddb0"),r("7db0"),r("a4d3"),r("e01a"),r("b0c0"),r("4de4"),r("d81d"),r("159b"),r("4fad"),r("b64b"),r("25f0"),r("ac1f"),r("1276"),r("2f62")),u=r("a70a");function l(e){this.currencyId=e}var h={props:{chapterId:Number,storyId:Number,chapterData:Object},data:function(){return{isNewChapter:!1,id:0,name:"",title:"Новая глава",description:"Описание главы",googleSheetId:"",readingTimeOption:0,rewards:[],anyChanges:!1,dataFetched:!1,idChanged:!1,titleChanged:!1,descriptionChanged:!1,readingTimeChanged:!1,googleSheetChanged:!1,rewardsChanged:!1,currenciesOptions:[{value:0,text:"Ожидание"}],selectedRewardOptions:{},rewardValues:{},isDefaultReward:!0,readingCost:1,readingCurrencyOption:2,readingCurrencyText:"",readingRuleChanged:!1}},components:{UiButton:function(){return r.e("chunk-7a628425").then(r.bind(null,"832a"))},NavBack:function(){return r.e("chunk-49c533a1").then(r.bind(null,"e019"))}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(d["e"])("firebase",["config"])),Object(d["e"])("stories",["storyStatuses","readingTime"])),Object(d["c"])("firebase",["getNewChapterID","getNextChapterOrder"])),{},{economyConfig:function(){return this.$store.state.firebase.config.EconomyConfig||{}},currencies:function(){return this.$store.state.firebase.config.Currencies},readingTimeText:function(){var e=this,t=this.readingTime.find((function(t){return t.time===e.readingTimeOption}));return t?t.text:"Ошибка"},realStoryId:function(){return this.storyId||0},saveButtonText:function(){return this.anyChanges?"Сохранить":"Сохранено"},saveButtonColor:function(){return this.anyChanges?"blue":"transparent"}}),mounted:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchData();case 2:case"end":return t.stop()}}),t)})))()},watch:{id:function(){this.changesCommonHandler("id")},title:function(){this.changesCommonHandler("title")},description:function(){this.changesCommonHandler("description")},googleSheetId:function(){this.changesCommonHandler("googleSheet")},readingTimeOption:function(){this.changesCommonHandler("readingTime")},readingCurrencyOption:function(){this.changesCommonHandler("readingRule")},readingCost:function(){this.changesCommonHandler("readingRule")}},methods:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(d["b"])("firebase",["getConfig","saveStoryChapter"])),Object(d["d"])("firebase",["SET_CHAPTER_DEFAULT_REWARD"])),{},{fetchData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getConfig();case 2:e.chapterData?(e.id=e.chapterData.id,e.title=e.chapterData.title,e.description=e.chapterData.description,e.readingTimeOption=e.chapterData.reading_time,e.name=e.chapterData.name,e.googleSheetId=e.chapterData.google_sheet_id,e.isDefaultReward=e.chapterData.reward_default,e.readingCurrencyOption=e.chapterData.reading_currency_id||e.economyConfig.chapter_reading_currency_id,e.readingCost=e.chapterData.reading_currency_value||e.economyConfig.chapter_reading_currency_value,e.chapterData.rewards.length?e.rewards=e.chapterData.rewards||[{currency_id:e.config.EconomyConfig.chapter_reward_currency_id,value:e.config.EconomyConfig.chapter_reward_currency_value}]:e.setDefaultReward()):(e.isNewChapter=!0,e.id=e.getNewChapterID,e.readingTimeOption=e.readingTime[0].time,e.readingCurrencyOption=e.economyConfig.chapter_reading_currency_id,e.readingCost=e.economyConfig.chapter_reading_currency_value,e.setDefaultReward()),setTimeout((function(){e.dataFetched=!0}),250),e.fillSelects();case 5:case"end":return t.stop()}}),t)})))()},addReward:function(){var e=this.getAvailableCurrencies();e.length&&(this.rewards.push({currency_id:e[0].id,value:0}),this.selectedRewardOptions["currency-".concat(e[0].id)]=e[0].id,this.rewardValues["currency-".concat(e[0].id)]=0,this.isDefaultReward=!1)},deleteReward:function(e){this.rewards=this.rewards.filter((function(t){return t.currency_id!==e})),delete this.selectedRewardOptions["currency-".concat(e)],delete this.rewardValues["currency-".concat(e)],!this.rewards.length&&this.isDefaultReward&&this.setDefaultReward()},setDefaultReward:function(){this.rewards=[{currency_id:this.config.EconomyConfig.chapter_reward_currency_id,value:this.config.EconomyConfig.chapter_reward_currency_value}],this.selectedRewardOptions=Object(c["a"])({},"currency-".concat(this.config.EconomyConfig.chapter_reward_currency_id),this.config.EconomyConfig.chapter_reward_currency_id),this.rewardValues=Object(c["a"])({},"currency-".concat(this.config.EconomyConfig.chapter_reward_currency_id),this.config.EconomyConfig.chapter_reward_currency_value),this.isDefaultReward=!0},fillSelects:function(){var e=this;this.currenciesOptions=this.currencies.filter((function(e){return e.id>0})).map((function(e){return{value:e.id,text:e.name}}));var t=this.currenciesOptions.find((function(t){return t.value===e.readingCurrencyOption}));this.readingCurrencyOption=t.value,this.readingCurrencyText=t.text,this.rewards.length&&!this.isDefaultReward?this.rewards.forEach((function(t){e.selectedRewardOptions["currency-".concat(t.currency_id)]=t.currency_id,e.rewardValues["currency-".concat(t.currency_id)]=t.value})):this.isDefaultReward&&(this.rewards=[{currency_id:this.config.EconomyConfig.chapter_reward_currency_id,value:this.config.EconomyConfig.story_reward_currency_value}],this.selectedRewardOptions["currency-".concat(this.config.EconomyConfig.chapter_reward_currency_id)]=this.config.EconomyConfig.chapter_reward_currency_id,this.rewardValues["currency-".concat(this.config.EconomyConfig.chapter_reward_currency_id)]=this.config.EconomyConfig.chapter_reward_currency_value)},changesCommonHandler:function(e){this.dataFetched&&(this.anyChanges=!0,this["".concat(e,"Changed")]=!0)},onReadingTimeSelect:function(e){this.readingTimeOption=parseInt(e.currentTarget.dataset.value,10)},onSaveClick:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,n,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r={},!e.googleSheetId.length){t.next=5;break}r.google_sheet_id=e.googleSheetId,t.next=7;break;case 5:return alert("Необходимо заполнить ID google таблицы для главы"),t.abrupt("return");case 7:if(r.id=e.id,r.story_id=e.storyId,r.is_published=!1,r.order=e.chapterData?e.chapterData.order:e.getNextChapterOrder(e.storyId),r.title=e.title,r.description=e.description,r.reading_time=parseInt(e.readingTimeOption,10),r.reading_currency_id=e.readingCurrencyOption,r.reading_currency_value=parseInt(e.readingCost,10),!e.rewardsChanged){t.next=36;break}a={},r.rewards=[{currency_id:e.config.EconomyConfig.chapter_reward_currency_id,value:e.config.EconomyConfig.chapter_reward_currency_value}],Object.entries(e.selectedRewardOptions).forEach((function(t){var n=Object(i["a"])(t,2),c=n[0],s=n[1];r.rewards.push({currency_id:s,value:parseInt(e.rewardValues[c],10)}),a[s]?a[s]++:a[s]=1})),t.prev=20,Object.entries(a).forEach((function(e){var t=Object(i["a"])(e,2),r=t[0],a=t[1];if(a>1)throw new l(parseInt(r),10)})),t.next=33;break;case 24:if(t.prev=24,t.t0=t["catch"](20),t.t0.currencyId){t.next=30;break}throw t.t0;case 30:return n=e.currencies.find((function(e){return e.id===t.t0.currencyId})),u["a"].$emit("show-notification-message","Дублирующаяся награда: ".concat(n.name)),t.abrupt("return");case 33:r.reward_default=e.isDefaultReward=!1,t.next=37;break;case 36:e.isNewChapter&&(r.rewards=[{currency_id:e.economyConfig.chapter_reward_currency_id,value:e.economyConfig.chapter_reward_currency_value}],r.reward_default=!0);case 37:return e.isNewChapter?(r.created_at=(new Date).toISOString(),r.is_published=!1,r.order=e.getNextChapterOrder(e.storyId)):Object.keys(e.chapterData).forEach((function(t){!r.hasOwnProperty(t)&&(r[t]=e.chapterData[t])})),t.next=40,e.saveStoryChapter({storyId:parseInt(e.realStoryId,10),chapterData:r});case 40:if(c=t.sent,c.error){t.next=49;break}if(u["a"].$emit("show-notification-message","Сохранено"),e.resetChangedFlags(),!e.isNewChapter){t.next=47;break}return t.next=47,e.$router.push({name:"chapters",params:{chapterId:e.id,storyId:e.storyId,chapterData:r},hash:"/".concat(e.id)});case 47:t.next=50;break;case 49:u["a"].$emit("show-notification-message","Ошибка: ".concat(c.error.toString()));case 50:case"end":return t.stop()}}),t,null,[[20,24]])})))()},resetRewardToDefault:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.SET_CHAPTER_DEFAULT_REWARD({storyId:e.storyId,chapterId:e.id}),e.setDefaultReward();case 2:case"end":return t.stop()}}),t)})))()},resetChangedFlags:function(){this.anyChanges=!1,this.idChanged=!1,this.titleChanged=!1,this.descriptionChanged=!1,this.readingTimeChanged=!1,this.rewardsChanged=!1,this.readingRuleChanged=!1},getAvailableCurrencies:function(){var e=Object.keys(this.selectedRewardOptions).map((function(e){return parseInt(e.split("currency-")[1],10)}));return this.currencies.filter((function(t){return-1===e.indexOf(t.id)&&t.id>0}))},onRewardsClick:function(){this.anyChanges=!0,this.rewardsChanged=!0},clipStoryId:function(){this.$clipboard(this.storyId),u["a"].$emit("show-notification-message","ID скопирован в буфер обмена")},clip:function(e){this.$clipboard(e),u["a"].$emit("show-notification-message","ID скопирован в буфер обмена")},onReadingCurrencyChanged:function(e){var t=this;this.readingCurrencyOption=parseInt(e.currentTarget.dataset.value,10),this.readingCurrencyText=this.currenciesOptions.find((function(e){return e.value===t.readingCurrencyOption})).text}})},p=h,g=(r("d72c"),r("2877")),f=Object(g["a"])(p,a,n,!1,null,null,null);t["default"]=f.exports},"99e6":function(e,t,r){},a9e3:function(e,t,r){"use strict";var a=r("83ab"),n=r("da84"),i=r("94ca"),c=r("6eeb"),s=r("5135"),o=r("c6b6"),d=r("7156"),u=r("c04e"),l=r("d039"),h=r("7c73"),p=r("241c").f,g=r("06cf").f,f=r("9bf2").f,_=r("58a8").trim,m="Number",v=n[m],C=v.prototype,w=o(h(C))==m,y=function(e){var t,r,a,n,i,c,s,o,d=u(e,!1);if("string"==typeof d&&d.length>2)if(d=_(d),t=d.charCodeAt(0),43===t||45===t){if(r=d.charCodeAt(2),88===r||120===r)return NaN}else if(48===t){switch(d.charCodeAt(1)){case 66:case 98:a=2,n=49;break;case 79:case 111:a=8,n=55;break;default:return+d}for(i=d.slice(2),c=i.length,s=0;s<c;s++)if(o=i.charCodeAt(s),o<48||o>n)return NaN;return parseInt(i,a)}return+d};if(i(m,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var b,I=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof I&&(w?l((function(){C.valueOf.call(r)})):o(r)!=m)?d(new v(y(t)),r,I):y(t)},x=a?p(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),O=0;x.length>O;O++)s(v,b=x[O])&&!s(I,b)&&f(I,b,g(v,b));I.prototype=C,C.constructor=I,c(n,m,I)}},d72c:function(e,t,r){"use strict";r("99e6")}}]);
//# sourceMappingURL=chapters.39b13757.js.map