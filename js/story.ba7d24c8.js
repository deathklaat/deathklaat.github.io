(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["story"],{"00c8":function(t,e,r){},2909:function(t,e,r){"use strict";r.d(e,"a",(function(){return c}));var a=r("6b75");function n(t){if(Array.isArray(t))return Object(a["a"])(t)}r("a4d3"),r("e01a"),r("d3b7"),r("d28b"),r("3ca3"),r("ddb0"),r("a630");function i(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}var s=r("06c5");function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t){return n(t)||i(t)||Object(s["a"])(t)||o()}},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,r){var a=r("1d80"),n=r("5899"),i="["+n+"]",s=RegExp("^"+i+i+"*"),o=RegExp(i+i+"*$"),c=function(t){return function(e){var r=String(a(e));return 1&t&&(r=r.replace(s,"")),2&t&&(r=r.replace(o,"")),r}};t.exports={start:c(1),end:c(2),trim:c(3)}},"68bf":function(t,e,r){},"8ddb":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.dataFetched?r("div",{staticClass:"story-page page"},[r("div",{staticClass:"story-page__header d-flex"},[r("div",{staticClass:"story-page__header-left"},[r("nav-back"),t._v(" "+t._s(t.title)+" ")],1),r("div",{staticClass:"story-page__header-right"},[r("ui-button",{class:{"story-page__save-button--disabled":!t.anyChanges},attrs:{color:t.saveButtonColor},on:{clicked:t.onSaveClick}},[t._v(" "+t._s(t.saveButtonText)+" ")])],1)]),r("div",{staticClass:"row mt-3 ml-1 font-weight-bold",staticStyle:{position:"relative","margin-bottom":"-20px"}},[r("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"story-page__story-id",attrs:{title:"Скопировать"},on:{click:t.clipStoryId}},[t._v(" ID истории: "+t._s(t.intStoryId)+" ")])]),r("div",{staticClass:"story-page__content d-flex"},[r("div",{staticClass:"story-page__story-data d-flex"},[t._m(0),r("div",{staticClass:"row page__input"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title",attrs:{for:"storyKeyInput"}},[t._v("Ключ-идентификатор")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.key,expression:"key"}],staticClass:"form-control",class:{"data-changed":t.keyChanged},attrs:{type:"text",id:"storyKeyInput","aria-describedby":"storyKeyInput",placeholder:"String_value",disabled:!t.isNewStory},domProps:{value:t.key},on:{input:function(e){e.target.composing||(t.key=e.target.value)}}})])]),r("div",{staticClass:"row page__input"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title",attrs:{for:"storyTitleInput"}},[t._v("Название")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"form-control",class:{"data-changed":t.titleChanged},attrs:{type:"text",id:"storyTitleInput","aria-describedby":"storyTitleInput",placeholder:"Название"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})])]),r("div",{staticClass:"row page__input"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title"},[t._v("Краткое описание")]),r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"form-control",class:{"data-changed":t.descriptionChanged},attrs:{id:"storyDescriptionInput",rows:"3",placeholder:"Краткое описание"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})])]),r("div",{staticClass:"row page__input"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title"},[t._v("Вес в рекомендованных")]),r("input",{directives:[{name:"model",rawName:"v-model.number",value:t.recommendedOrder,expression:"recommendedOrder",modifiers:{number:!0}}],staticClass:"form-control",class:{"data-changed":t.recommendedChanged},attrs:{type:"number",min:"0",oninput:"validity.valid||(value=0)"},domProps:{value:t.recommendedOrder},on:{input:function(e){e.target.composing||(t.recommendedOrder=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])]),t.isNewStory?t._e():[r("label",{staticClass:"story-page__label mt-4",class:{"data-changed":t.lastChapterChanged}},[t._v(" Последняя глава ")]),r("b-form-select",{staticClass:"form-control",attrs:{options:t.lastChapterOptions},model:{value:t.lastChapterId,callback:function(e){t.lastChapterId=e},expression:"lastChapterId"}})],r("div",{staticClass:"row story-page__sub-row"},[r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title"},[t._v("За кого можно играть")]),r("br"),r("b-dropdown",{staticClass:"m-md-2 stories-page__filter-dropdown",class:{"data-changed":t.restrictionGenderChanged},attrs:{text:t.restrictionGenderText,id:"storyCharacterRestriction"}},t._l(t.restrictionsGender,(function(e,a){return r("b-dropdown-item",{key:a,attrs:{"data-value":a},on:{click:t.onGenderRestrictionChanged}},[t._v(" "+t._s(e.name)+" ")])})),1)],1)]),r("div",{staticClass:"col"},[r("div",{staticClass:"form-group",staticStyle:{"margin-left":"20px"}},[r("label",{staticClass:"page__input-title"},[t._v("Возрастные ограничения")]),r("br"),r("b-dropdown",{staticClass:"m-md-2 stories-page__filter-dropdown",class:{"data-changed":t.restrictionAgeChanged},attrs:{text:t.restrictionAgeText,id:"storyAgeRestriction"}},t._l(t.restrictionsAge,(function(e,a){return r("b-dropdown-item",{key:a,attrs:{"data-value":""+e.isAdult},on:{click:t.onAgeRestrictionChanged}},[t._v(" "+t._s(e.name)+" ")])})),1)],1)])]),r("div",{staticClass:"row page__input"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title",class:{"data-changed":t.categoriesChanged}},[t._v(" Категории ")]),r("br"),t._l(t.categoriesList,(function(e,a){return r("ui-button",{key:a,staticClass:"story-page__category-button",attrs:{color:"transparent"},on:{clicked:function(r){return t.onDeleteCategoryClick(e.id)}}},[t._v(" "+t._s(e.name)+" ")])})),r("ui-button",{staticClass:"page__plus-button",attrs:{color:"transparent"},on:{clicked:t.onAddCategoryClick}},[t._v(" + ")])],2)]),r("div",{staticClass:"row page__input"},[r("div",{staticClass:"form-group"},[r("label",{staticClass:"page__input-title",class:{"data-changed":t.genresChanged}},[t._v(" Жанры ")]),r("br"),t._l(t.genresList,(function(e,a){return r("ui-button",{key:a,staticClass:"story-page__category-button",attrs:{color:"transparent"},on:{clicked:function(r){return t.onDeleteGenreClick(e)}}},[t._v(" "+t._s(e.name)+" ")])})),r("ui-button",{staticClass:"page__plus-button",attrs:{color:"transparent"},on:{clicked:t.onAddGenreClick}},[t._v(" + ")])],2)]),r("label",{staticClass:"story-page__label mt-4",class:{"data-changed":t.rewardsChanged},staticStyle:{"box-shadow":"none !important"}},[t._v(" Награды за прохождение истории ")]),t.rewards.length?t._e():r("span",{staticClass:"mb-3 mt-1",staticStyle:{"font-size":"16px"}},[t._v("Отсутствуют")]),t._l(t.rewards,(function(e){return void 0!==typeof t.selectedRewardOptions["currency-"+e.currency_id]?r("div",{key:e.currency_id,staticClass:"mb-4",on:{click:t.onRewardsClick}},[r("div",{staticClass:"d-flex flex-row align-items-center"},[r("div",{staticClass:"d-flex flex-column"},[r("b-form-select",{staticClass:"form-control story-page__reward-input",attrs:{options:t.currenciesOptions},model:{value:t.selectedRewardOptions["currency-"+e.currency_id],callback:function(r){t.$set(t.selectedRewardOptions,"currency-"+e.currency_id,r)},expression:"selectedRewardOptions[`currency-${reward.currency_id}`]"}}),r("input",{directives:[{name:"model",rawName:"v-model.number",value:t.rewardValues["currency-"+e.currency_id],expression:"rewardValues[`currency-${reward.currency_id}`]",modifiers:{number:!0}}],staticClass:"form-control mt-2 story-page__reward-input",attrs:{type:"number",placeholder:"Количество",min:"0",oninput:"validity.valid||(value=0)"},domProps:{value:t.rewardValues["currency-"+e.currency_id]},on:{input:function(r){r.target.composing||t.$set(t.rewardValues,"currency-"+e.currency_id,t._n(r.target.value))},blur:function(e){return t.$forceUpdate()}}})],1),r("div",{staticClass:"d-flex flex-column"},[t.isDefaultReward?t._e():r("svg",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"bi bi-x-circle ml-4 story-page__reset-reward",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",title:"Удалить награду",viewBox:"0 0 16 16"},on:{click:function(r){return t.deleteReward(e.currency_id)}}},[r("path",{attrs:{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}}),r("path",{attrs:{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"}})])])])]):t._e()})),t.getAvailableCurrencies().length?r("ui-button",{staticClass:"mb-2",staticStyle:{"max-width":"290px"},attrs:{color:"transparent"},on:{clicked:t.addReward}},[t._v(" Добавить награду ")]):t._e(),t.isDefaultReward?t._e():r("ui-button",{staticStyle:{"max-width":"290px"},attrs:{color:"transparent"},on:{clicked:t.resetRewardToDefault}},[t._v(" Сбросить награды на дефолт ")])],2),t.isNewStory?t._e():r("div",{staticClass:"story-page__chapters-data"},[r("div",{staticClass:"story-page__chapters-title mt-4 ml-2"},[t._v(" Главы ")]),r("ui-button",{staticClass:"story-page__add-chapter-button ml-2",on:{clicked:t.onAddChapterClick}},[t._v(" Добавить главу ")]),t.sortedChapters.length?r("div",{staticClass:"story-page__chapters-list"},[r("draggable",t._b({staticClass:"list-group",attrs:{tag:"ul",move:t.onChaptersMoved},on:{start:function(e){t.chapterDragging=!0},end:function(e){t.chapterDragging=!1}},model:{value:t.sortedChapters,callback:function(e){t.sortedChapters=e},expression:"sortedChapters"}},"draggable",t.chapterDragOptions,!1),[r("transition-group",{attrs:{type:"transition",name:t.chapterDragging?null:"flip-list"}},t._l(t.sortedChapters,(function(e,a){return r("li",{key:e.id,staticClass:"list-group-item story-page__chapter-item"},[r("chapter-item",{attrs:{"chapter-id":e.id,"chapter-number":a+1,"story-id":t.intStoryId,chapterData:e}})],1)})),0)],1)],1):r("div",[r("div",{staticClass:"story-page__no-chapters"},[t._v(" Глав нет ")])])],1)])]):t._e()},n=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row mb-4 mr-4"},[r("div",{staticClass:"page-title row"},[t._v("Описание истории")])])}],i=r("ade3"),s=r("1da1"),o=r("2909"),c=r("5530"),d=r("3835"),l=(r("96cf"),r("159b"),r("4fad"),r("d3b7"),r("3ca3"),r("ddb0"),r("99af"),r("d81d"),r("7db0"),r("b0c0"),r("4de4"),r("a4d3"),r("e01a"),r("b64b"),r("25f0"),r("c740"),r("a434"),r("ac1f"),r("1276"),r("2f62")),u={M:{name:"Male",isForMen:!0,isForWomen:!1},F:{name:"Female",isForMen:!1,isForWomen:!0},"F&M":{name:"Male & Female",isForMen:!0,isForWomen:!0}},h=r("bc87"),p=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal-popup add-story-category-modal",on:{click:t.resetAlert,keyup:function(e){return e.type.indexOf("key")||13===e.keyCode?t.onAddClick.apply(null,arguments):null}}},[r("div",{staticClass:"mb-3 modal-popup__title"},[t._v(" Добавление жанра "),r("svg",{staticClass:"bi bi-x-lg modal-popup__close",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2D4C70",viewBox:"0 0 16 16"},on:{click:t.close}},[r("path",{attrs:{d:"M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z"}})])]),r("div",{staticClass:"form-group"},[r("b-dropdown",{staticClass:"m-md-2 add-story-category-modal__filter-dropdown",attrs:{text:t.selectedText}},t._l(t.availableCategories,(function(e,a){return r("b-dropdown-item",{key:a,attrs:{"data-value":e.id},on:{click:t.onCategorySelect}},[t._v(" "+t._s(e.name)+" ")])})),1)],1),r("ui-button",{staticClass:"mt-3 mb-2",attrs:{disabled:!t.availableCategories.length},on:{clicked:t.onAddClick}},[t._v("Добавить")]),t.alert.length?r("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[t._v(t._s(t.alert))]):t._e()],1)},g=[],f=(r("a9e3"),r("a70a")),y={props:{storyId:Number,tempCategories:Array},data:function(){return{name:"",alert:"",canReset:!1,selectedOption:0}},components:{UiButton:function(){return r.e("chunk-7a628425").then(r.bind(null,"832a"))}},created:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getConfig();case 2:case"end":return e.stop()}}),e)})))()},computed:Object(c["a"])(Object(c["a"])({},Object(l["c"])("firebase",["getStoryById"])),{},{categories:function(){return this.$store.state.firebase.config.Categories},selectedText:function(){var t=this;if(!this.selectedOption)return this.availableCategories.length?this.availableCategories[0].name:"";var e=this.availableCategories.find((function(e){return e.id===t.selectedOption}));return e?e.name:""},availableCategories:function(){var t=this,e=this.getStoryById(this.storyId);return e?this.categories.filter((function(t){var r=e.categories.find((function(e){return e.id===t.id}));return!r})):this.categories.filter((function(e){var r=t.tempCategories.find((function(t){return t.id===e.id}));return!r}))}}),methods:Object(c["a"])(Object(c["a"])(Object(c["a"])({},Object(l["b"])("firebase",["getConfig"])),Object(l["d"])("firebase",["ADD_STORY_TO_CATEGORY"])),{},{resetAlert:function(){this.canReset&&(this.alert="",this.canReset=!1)},onCategorySelect:function(t){this.selectedOption=parseInt(t.currentTarget.dataset.value,10)},onAddClick:function(){this.availableCategories.length&&(0===this.selectedOption&&(this.selectedOption=this.availableCategories[0].id),this.ADD_STORY_TO_CATEGORY({storyId:this.storyId,categoryId:this.selectedOption}),f["a"].$emit("story-categories-changed",this.selectedOption),this.close())},close:function(){this.$modal.hide("add-story-category-modal")}})},m=y,_=(r("e724"),r("2877")),C=Object(_["a"])(m,p,g,!1,null,null,null),v=C.exports,b=function(t,e){var r=new h["a"]({component:v,props:{storyId:t,tempCategories:e},params:{transition:"scale",name:"add-story-category-modal",width:"100%",height:"100%",classes:"modal-popup__overlay"}});r.show()},w=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal-popup add-story-genre-modal",on:{click:t.resetAlert,keyup:function(e){return e.type.indexOf("key")||13===e.keyCode?t.onAddClick.apply(null,arguments):null}}},[r("div",{staticClass:"mb-3 modal-popup__title"},[t._v(" Добавление жанра "),r("svg",{staticClass:"bi bi-x-lg modal-popup__close",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#2D4C70",viewBox:"0 0 16 16"},on:{click:t.close}},[r("path",{attrs:{d:"M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z"}})])]),r("div",{staticClass:"form-group"},[r("b-dropdown",{staticClass:"m-md-2 add-story-category-modal__filter-dropdown",attrs:{text:t.selectedText}},t._l(t.availableGenres,(function(e,a){return r("b-dropdown-item",{key:a,attrs:{"data-value":e.id},on:{click:t.onGenreSelect}},[t._v(" "+t._s(e.name)+" ")])})),1)],1),r("ui-button",{staticClass:"mt-3 mb-2",attrs:{disabled:!t.availableGenres.length},on:{clicked:t.onAddClick}},[t._v("Добавить")]),t.alert.length?r("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[t._v(t._s(t.alert))]):t._e()],1)},O=[],I={props:{storyId:Number,tempGenres:Array},data:function(){return{name:"",alert:"",canReset:!1,selectedOption:0}},components:{UiButton:function(){return r.e("chunk-7a628425").then(r.bind(null,"832a"))}},created:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getConfig();case 2:case"end":return e.stop()}}),e)})))()},computed:Object(c["a"])(Object(c["a"])({},Object(l["c"])("firebase",["getStoryById","getGenreById"])),{},{genres:function(){return this.$store.state.firebase.config.Genres||[]},selectedText:function(){var t=this;if(!this.selectedOption)return this.availableGenres.length?this.availableGenres[0].name:"";var e=this.availableGenres.find((function(e){return e.id===t.selectedOption}));return e.name||""},availableGenres:function(){var t=this,e=this.getStoryById(this.storyId);return e?this.genres.filter((function(t){var r=e.genres.findIndex((function(e){return e.id===t.id}));return-1===r})):this.genres.filter((function(e){var r=t.tempGenres.find((function(t){return t.id===e.id}));return!r}))}}),methods:Object(c["a"])(Object(c["a"])(Object(c["a"])({},Object(l["b"])("firebase",["getConfig"])),Object(l["d"])("firebase",["ADD_STORY_GENRE"])),{},{resetAlert:function(){this.canReset&&(this.alert="",this.canReset=!1)},onGenreSelect:function(t){this.selectedOption=parseInt(t.currentTarget.dataset.value,10)},onAddClick:function(){if(this.availableGenres.length){0===this.selectedOption&&(this.selectedOption=this.availableGenres[0].id);var t=this.getGenreById(this.selectedOption);this.ADD_STORY_GENRE({storyId:this.storyId,genreData:t}),f["a"].$emit("story-genres-changed",this.selectedOption),this.close()}},close:function(){this.$modal.hide("add-story-genre-modal")}})},S=I,k=(r("ff56"),Object(_["a"])(S,w,O,!1,null,null,null)),R=k.exports,x=function(t,e){var r=new h["a"]({component:R,props:{storyId:t,tempGenres:e},params:{transition:"scale",name:"add-story-genre-modal",width:"100%",height:"100%",classes:"modal-popup__overlay"}});r.show()},D=r("b76a"),A=r.n(D),G=function(t,e){var r;return Object.entries(u).forEach((function(a){var n=Object(d["a"])(a,2),i=n[0],s=n[1];s.isForMen===t&&s.isForWomen===e&&(r=i)})),r};function E(t){this.currencyId=t}var j={props:["storyId"],data:function(){return{pageIsReady:!1,intStoryId:0,isNewStory:!1,key:"",title:"Новая история",description:"Краткое описание",availableOnProduction:!1,restrictionGenderOption:"F&M",restrictionAgeOption:!1,isAdult:!1,rewards:[],recommendedOrder:0,anyChanges:!1,dataFetched:!1,storyData:Object,keyChanged:!1,titleChanged:!1,descriptionChanged:!1,restrictionGenderChanged:!1,restrictionAgeChanged:!1,categoriesChanged:!1,genresChanged:!1,skillsChanged:!1,publishVariantChanged:!1,publishDayChanged:!1,storyStatusChanged:!1,rewardsChanged:!1,lastChapterChanged:!1,recommendedChanged:!1,chapterDragging:!1,restrictionsAge:[{isAdult:!1,name:"Без ограничений"},{isAdult:!0,name:"18+"}],tempGenres:[],tempCategories:[],chaptersDragLocked:!1,currenciesOptions:[{value:0,text:"Ожидание"}],selectedRewardOptions:{},rewardValues:{},isDefaultReward:!0,lastChapterId:null}},components:{draggable:A.a,NavBack:function(){return r.e("chunk-49c533a1").then(r.bind(null,"e019"))},UiButton:function(){return r.e("chunk-7a628425").then(r.bind(null,"832a"))},ChapterItem:function(){return r.e("chunk-47473edb").then(r.bind(null,"e9d4"))}},computed:Object(c["a"])(Object(c["a"])(Object(c["a"])({},Object(l["e"])("firebase",["chaptersSortingOrder"])),Object(l["c"])("firebase",["getCategoryById","getStoryCategories","getStoryChapters","getChapterById","getGenreById","getNewStoryID","getDefaultStoryReward","getStoryGenres"])),{},{economyConfig:function(){return this.$store.state.firebase.config.EconomyConfig||{}},stories:function(){return this.$store.state.firebase.config.Stories.stories},genres:function(){return this.$store.state.firebase.config.Genres||[]},categories:function(){return this.$store.state.firebase.config.Categories.categories},currencies:function(){return this.$store.state.firebase.config.Currencies||[]},lastChapterOptions:function(){var t=this.getStoryChapters(this.intStoryId);return[{text:"Не установлена",value:0}].concat(Object(o["a"])(t.map((function(t){return{text:t.title,value:t.id}}))))},sortedChapters:{get:function(){var t=this,e=this.getStoryChapters(this.intStoryId);if(!e||!e.length)return[];var r=this.chaptersSortingOrder[this.intStoryId]||!1;r||(r=e.map((function(t){return t.id})),this.$store.commit("firebase/UPDATE_CHAPTERS_SORTING_ORDER",{storyId:this.intStoryId,order:r}));var a=[];return r.forEach((function(e){var r=t.getChapterById(t.intStoryId,e);r&&a.push(r)})),a},set:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=t.map((function(t){return t.id})),e.chaptersDragLocked=!0,e.UPDATE_CHAPTERS_SORTING_ORDER({storyId:e.intStoryId,order:a}),e.chaptersDragLocked=!1,e.anyChanges=!0,f["a"].$emit("show-notification-message","Нужно сохранить историю для сортировки");case 6:case"end":return r.stop()}}),r)})))()}},chapterDragOptions:function(){return{animation:0,group:"description",disabled:!1,ghostClass:"ghost"}},saveButtonText:function(){return this.anyChanges?"Сохранить":"Сохранено"},saveButtonColor:function(){return this.anyChanges?"blue":"transparent"},restrictionsGender:function(){return u},restrictionAgeText:function(){var t=this,e=this.restrictionsAge.find((function(e){return e.isAdult===t.restrictionAgeOption}));return e?e.name:""},restrictionGenderText:function(){var t=u[this.restrictionGenderOption];return t?t.name:""},genresList:function(){return this.isNewStory?this.tempGenres:this.getStoryGenres(this.intStoryId)},categoriesList:function(){return this.isNewStory?this.tempCategories:this.getStoryCategories(this.intStoryId)}}),watch:{lastChapterId:function(){this.changesCommonHandler("lastChapter")},key:function(){this.changesCommonHandler("key")},title:{handler:function(){this.changesCommonHandler("title")}},description:{handler:function(){this.changesCommonHandler("description")}},restrictionGenderOption:{handler:function(){this.changesCommonHandler("restrictionGender")}},restrictionAgeOption:{handler:function(){this.changesCommonHandler("restrictionAge")}},recommendedOrder:function(){this.changesCommonHandler("recommended")}},created:function(){f["a"].$off("story-genres-changed").$on("story-genres-changed",this.onGenresChanged),f["a"].$off("story-categories-changed").$on("story-categories-changed",this.onCategoriesChanged)},mounted:function(){this.fetchData()},beforeDestroy:function(){f["a"].$off("story-categories-changed"),f["a"].$off("story-genres-changed")},methods:Object(c["a"])(Object(c["a"])(Object(c["a"])({},Object(l["b"])("firebase",["getConfig","saveStory"])),Object(l["d"])("firebase",["DELETE_STORY_FROM_CATEGORY","DELETE_STORY_GENRE","UPDATE_CHAPTERS_SORTING_ORDER"])),{},{validateKey:function(){return this.key.length?!!/^[a-zA-Z0-9_]+$/.test(this.key)||(f["a"].$emit("show-notification-message","Ключ должен состоять из латиницы и прочерков"),!1):(f["a"].$emit("show-notification-message","Необходимо ввести ключ-идентификатор"),!1)},fetchData:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getConfig();case 2:t.fetchStories(),t.fillSelects(),setTimeout((function(){t.dataFetched=!0}),250);case 5:case"end":return e.stop()}}),e)})))()},fillSelects:function(){var t=this;this.currenciesOptions=this.currencies.filter((function(t){return t.id>0})).map((function(t){return{value:t.id,text:t.name}})),this.rewards.length&&!this.isDefaultReward?this.rewards.forEach((function(e){t.selectedRewardOptions["currency-".concat(e.currency_id)]=e.currency_id,t.rewardValues["currency-".concat(e.currency_id)]=e.value})):this.isDefaultReward&&(this.rewards=[{currency_id:this.economyConfig.story_reward_currency_id,value:this.economyConfig.story_reward_currency_value}],this.selectedRewardOptions["currency-".concat(this.economyConfig.story_reward_currency_id)]=this.economyConfig.story_reward_currency_id,this.rewardValues["currency-".concat(this.economyConfig.story_reward_currency_id)]=this.economyConfig.story_reward_currency_value),this.lastChapterId=this.storyData.last_chapter_id||0},onGenresChanged:function(t){this.isNewStory&&this.tempGenres.push(this.getGenreById(t)),this.anyChanges=!0,this.genresChanged=!0},onCategoriesChanged:function(t){this.isNewStory&&this.tempCategories.push(this.getCategoryById(t)),this.anyChanges=!0,this.categoriesChanged=!0},changesCommonHandler:function(t){this.dataFetched&&(this.anyChanges=!0,this["".concat(t,"Changed")]=!0)},fetchStories:function(){var t=this;this.storyId?(this.intStoryId=parseInt(this.storyId,10),this.storyData=this.stories.find((function(e){return e.id===t.intStoryId})),this.title=this.storyData.title,this.key=this.storyData.key,this.description=this.storyData.description,this.restrictionAgeOption=this.storyData.is_adult,this.restrictionGenderOption=G(this.storyData.is_man,this.storyData.is_woman),this.rewards=this.storyData.rewards||this.getDefaultStoryReward,this.isDefaultReward=this.storyData.reward_default,this.recommendedOrder=this.storyData.order_recommended||0):(this.isNewStory=!0,this.intStoryId=this.getNewStoryID,this.setDefaultReward())},onAgeRestrictionChanged:function(t){this.restrictionAgeOption="true"===t.currentTarget.dataset.value},onGenderRestrictionChanged:function(t){this.restrictionGenderOption=t.currentTarget.dataset.value},onSaveClick:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r,a,n,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.anyChanges){e.next=2;break}return e.abrupt("return",!1);case 2:if(t.validateKey()){e.next=4;break}return e.abrupt("return",!1);case 4:if(r=u[t.restrictionGenderOption],a={id:t.intStoryId,title:t.title,description:t.description,is_man:r.isForMen,is_woman:r.isForWomen,is_adult:t.restrictionAgeOption,order_recommended:t.recommendedOrder,chapters:t.sortedChapters.length?t.sortedChapters:[],last_chapter_id:t.lastChapterId||null,key:t.key,categories:t.isNewStory?t.tempCategories:t.getStoryCategories(t.intStoryId),genres:t.isNewStory?t.tempGenres:t.getStoryGenres(t.intStoryId)},a.is_published=null!=a.last_chapter_id,t.isNewStory&&(a.created_at=(new Date).toISOString()),!t.rewardsChanged){e.next=28;break}n={},a.rewards=[],Object.entries(t.selectedRewardOptions).forEach((function(e){var r=Object(d["a"])(e,2),i=r[0],s=r[1];a.rewards.push({currency_id:s,value:parseInt(t.rewardValues[i],10)}),n[s]?n[s]++:n[s]=1})),e.prev=12,Object.entries(n).forEach((function(t){var e=Object(d["a"])(t,2),r=e[0],a=e[1];if(a>1)throw new E(parseInt(r),10)})),e.next=25;break;case 16:if(e.prev=16,e.t0=e["catch"](12),e.t0.currencyId){e.next=22;break}throw e.t0;case 22:return i=t.currencies.find((function(t){return t.id===e.t0.currencyId})),f["a"].$emit("show-notification-message","Дублирующаяся награда: ".concat(i.name)),e.abrupt("return");case 25:a.reward_default=t.isDefaultReward=!1,e.next=29;break;case 28:t.isNewStory&&(a.rewards=t.getDefaultStoryReward,a.reward_default=!0);case 29:return Object.keys(t.storyData).forEach((function(e){return!a.hasOwnProperty(e)&&(a[e]=t.storyData[e])})),e.next=32,t.saveStory({storyData:a,isNewStory:t.isNewStory});case 32:if(s=e.sent,s.error){e.next=42;break}if(f["a"].$emit("show-notification-message","Сохранено"),t.anyChanges=!1,t.resetChangedFlags(),!s.redirectStory){e.next=40;break}return e.next=40,t.$router.push("/story/".concat(s.redirectStory));case 40:e.next=43;break;case 42:f["a"].$emit("show-notification-message","Ошибка: ".concat(s.error.toString()));case 43:case"end":return e.stop()}}),e,null,[[12,16]])})))()},deleteReward:function(t){this.rewards=this.rewards.filter((function(e){return e.currency_id!==t})),delete this.selectedRewardOptions["currency-".concat(t)],delete this.rewardValues["currency-".concat(t)],!this.rewards.length&&this.isDefaultReward&&this.setDefaultReward()},setDefaultReward:function(){this.rewards=[{currency_id:this.economyConfig.story_reward_currency_id,value:this.economyConfig.story_reward_currency_value}],this.selectedRewardOptions=Object(i["a"])({},"currency-".concat(this.economyConfig.story_reward_currency_id),this.economyConfig.story_reward_currency_id),this.rewardValues=Object(i["a"])({},"currency-".concat(this.economyConfig.story_reward_currency_id),this.economyConfig.story_reward_currency_value),this.isDefaultReward=!0},addReward:function(){var t=this.getAvailableCurrencies();t.length&&(this.rewards.push({currency_id:t[0].id,value:0}),this.selectedRewardOptions["currency-".concat(t[0].id)]=t[0].id,this.rewardValues["currency-".concat(t[0].id)]=0,this.isDefaultReward=!1)},resetRewardToDefault:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.saveStory({id:t.intStoryId,rewards:t.getDefaultStoryReward,reward_default:!0});case 2:r=e.sent,r.error?f["a"].$emit("show-notification-message","Ошибка: ".concat(r.error.toString())):(f["a"].$emit("show-notification-message","Награда сброшена на дефолт"),t.setDefaultReward(),t.rewardsChanged=!1);case 4:case"end":return e.stop()}}),e)})))()},resetChangedFlags:function(){this.titleChanged=!1,this.descriptionChanged=!1,this.restrictionGenderChanged=!1,this.restrictionAgeChanged=!1,this.genresChanged=!1,this.rewardsChanged=!1,this.lastChapterChanged=!1,this.categoriesChanged=!1,this.keyChanged=!1},onAddChapterClick:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$router.push({name:"chapters",params:{chapterId:0,storyId:t.intStoryId,chapterData:null}});case 2:case"end":return e.stop()}}),e)})))()},onAddCategoryClick:function(){b(this.intStoryId,this.tempCategories)},onDeleteCategoryClick:function(t){this.DELETE_STORY_FROM_CATEGORY({storyId:this.intStoryId,categoryId:t}),this.categoriesChanged=!0,this.anyChanges=!0},onAddGenreClick:function(){x(this.intStoryId,this.tempGenres)},onDeleteGenreClick:function(t){if(this.tempGenres.length){var e=this.tempGenres.findIndex((function(e){return e.id===t.id}));e>-1&&this.tempGenres.splice(e,1)}this.DELETE_STORY_GENRE({storyId:this.intStoryId,genreId:t.id}),this.genresChanged=!0,this.anyChanges=!0},onChaptersMoved:function(){return!this.chaptersDragLocked},getAvailableCurrencies:function(){var t=Object.keys(this.selectedRewardOptions).map((function(t){return parseInt(t.split("currency-")[1],10)}));return this.currencies.filter((function(e){return-1===t.indexOf(e.id)&&e.id>0}))},onRewardsClick:function(){this.anyChanges=!0,this.rewardsChanged=!0},clipStoryId:function(){this.$clipboard(this.intStoryId),f["a"].$emit("show-notification-message","ID скопирован в буфер обмена")}})},N=j,T=(r("f821"),Object(_["a"])(N,a,n,!1,null,null,null));e["default"]=T.exports},a9e3:function(t,e,r){"use strict";var a=r("83ab"),n=r("da84"),i=r("94ca"),s=r("6eeb"),o=r("5135"),c=r("c6b6"),d=r("7156"),l=r("c04e"),u=r("d039"),h=r("7c73"),p=r("241c").f,g=r("06cf").f,f=r("9bf2").f,y=r("58a8").trim,m="Number",_=n[m],C=_.prototype,v=c(h(C))==m,b=function(t){var e,r,a,n,i,s,o,c,d=l(t,!1);if("string"==typeof d&&d.length>2)if(d=y(d),e=d.charCodeAt(0),43===e||45===e){if(r=d.charCodeAt(2),88===r||120===r)return NaN}else if(48===e){switch(d.charCodeAt(1)){case 66:case 98:a=2,n=49;break;case 79:case 111:a=8,n=55;break;default:return+d}for(i=d.slice(2),s=i.length,o=0;o<s;o++)if(c=i.charCodeAt(o),c<48||c>n)return NaN;return parseInt(i,a)}return+d};if(i(m,!_(" 0o1")||!_("0b1")||_("+0x1"))){for(var w,O=function(t){var e=arguments.length<1?0:t,r=this;return r instanceof O&&(v?u((function(){C.valueOf.call(r)})):c(r)!=m)?d(new _(b(e)),r,O):b(e)},I=a?p(_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),S=0;I.length>S;S++)o(_,w=I[S])&&!o(O,w)&&f(O,w,g(_,w));O.prototype=C,C.constructor=O,s(n,m,O)}},bc87:function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var a=r("d4ec"),n=r("bee2"),i=(r("b0c0"),r("1881")),s=r.n(i),o=function(){function t(e){var r=e.component,n=e.props,i=void 0===n?{}:n,s=e.params,o=void 0===s?{}:s,c=e.events,d=void 0===c?{}:c;Object(a["a"])(this,t),this.component=r,this.props=i,this.params=o,this.events={opened:function(){Object.assign(r,{modalName:o.name})},closed:function(){}},Object.assign(this.events,d)}return Object(n["a"])(t,[{key:"show",value:function(){s.a.rootInstance.$modal.show(this.component,this.props,this.params,this.events)}},{key:"hide",value:function(){s.a.rootInstance.$emit("close")}}]),t}()},e724:function(t,e,r){"use strict";r("f6e2")},f6e2:function(t,e,r){},f821:function(t,e,r){"use strict";r("68bf")},ff56:function(t,e,r){"use strict";r("00c8")}}]);
//# sourceMappingURL=story.ba7d24c8.js.map